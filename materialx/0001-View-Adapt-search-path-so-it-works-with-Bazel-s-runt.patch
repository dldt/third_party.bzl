From 249e91128d09c7b0547b4410ada251337123ad0b Mon Sep 17 00:00:00 2001
From: Thomas Arcila <thomas.arcila@gmail.com>
Date: Thu, 4 Mar 2021 06:36:15 +0100
Subject: [PATCH] View: Adapt search path so it works with Bazel's runtime
 files

---
 source/MaterialXView/Main.cpp | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/source/MaterialXView/Main.cpp b/source/MaterialXView/Main.cpp
index 5c4eadd..df68283 100644
--- a/source/MaterialXView/Main.cpp
+++ b/source/MaterialXView/Main.cpp
@@ -55,10 +55,19 @@ mx::FileSearchPath getDefaultSearchPath()
     mx::FilePath modulePath = mx::FilePath::getModulePath();
     mx::FilePath installRootPath = modulePath.getParentPath();
     mx::FilePath devRootPath = installRootPath.getParentPath().getParentPath().getParentPath();
+    // Bazel case, where the binary is run from the folder holding the runfiles.
+    mx::FilePath bazelSearchPath = mx::FilePath::getCurrentPath();
+    mx::FilePath bazelSearchPathExternal = mx::FilePath::getCurrentPath() / "external" / "materialx";
 
     mx::FileSearchPath searchPath;
     searchPath.append(installRootPath);
     searchPath.append(devRootPath);
+    if ( (bazelSearchPath / "libraries").exists()) {
+        searchPath.append(bazelSearchPath);
+    }
+    if ( (bazelSearchPathExternal / "libraries").exists()) {
+        searchPath.append(bazelSearchPathExternal);
+    }
 
     return searchPath;
 }
-- 
2.30.1.windows.1

